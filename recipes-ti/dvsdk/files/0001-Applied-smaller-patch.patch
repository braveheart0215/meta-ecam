From 48dc8a8bdba90d7debd4d9f92721749a575302ce Mon Sep 17 00:00:00 2001
From: Garrett <g@floft.net>
Date: Wed, 14 Aug 2013 15:12:15 -0700
Subject: [PATCH] Applied smaller patch

---
 Makefile                                           |   10 ++++----
 Rules.make                                         |    2 +-
 .../packages/ti/sdo/dmai/linux/omap3530/Capture.c  |   26 ++++++++++----------
 3 files changed, 19 insertions(+), 19 deletions(-)

diff --git a/Makefile b/Makefile
index 3774211..2f1f790 100755
--- a/Makefile
+++ b/Makefile
@@ -21,22 +21,22 @@ default: all
 #==============================================================================
 # Build target build necessary components to enable all other build targets.
 #==============================================================================
-components: linux cmem sdma dsplink lpm c6run c6accel codecs dmai  
+components: cmem sdma dsplink lpm c6run c6accel codecs dmai  
 
 #==============================================================================
 # Clean up the targets built by 'make all'.
 #==============================================================================
-clean:	linux_clean dsplink_clean cmem_clean lpm_clean sdma_clean c6run_clean codecs_clean dmai_clean c6accel_clean ceexamples_clean u-boot_clean  demos_clean psp_examples_clean opengldemos_clean xload_clean dvtb_clean
+clean:	dsplink_clean cmem_clean lpm_clean sdma_clean c6run_clean codecs_clean dmai_clean c6accel_clean
 
 #==============================================================================
 # Build everything rebuildable.
 #==============================================================================
-all: components u-boot ceexamples demos psp_examples opengldemos xload c6run_examples matrix gstreamer_ti dvtb
+all: components gstreamer_ti
 
 #==============================================================================
 # Install everything
 #==============================================================================
-install: linux_install cmem_install sdma_install opengldemos_install ceexamples_install codecs_install lpm_install dsplink_install u-boot_install dmai_install demos_install  psp_examples_install c6accel_install xload_install c6run_install matrix_install gstreamer_ti_install loadmodule_install dvtb_install
+install: cmem_install sdma_install codecs_install lpm_install dsplink_install dmai_install c6accel_install c6run_install gstreamer_ti_install loadmodule_install
 
 #==============================================================================
 # A help message target.
@@ -806,7 +806,7 @@ c6run:
 	LPM_INSTALL_DIR="$(LPM_INSTALL_DIR)" \
 	ARM_TOOLCHAIN_PATH="$(CSTOOL_DIR)" \
 	ARM_TOOLCHAIN_PREFIX="arm-arago-linux-gnueabi-" \
-	DSP_REGION_BASE_ADDR=0x83700000 \
+	DSP_REGION_BASE_ADDR=0x90000000 \
 	DSP_REGION_CMEM_SIZE=0x02200000 \
 	DSP_REGION_CODE_SIZE=0x02700000 \
 	dm3730_config
diff --git a/dmai_2_20_00_15/packages/ti/sdo/dmai/linux/omap3530/Capture.c b/dmai_2_20_00_15/packages/ti/sdo/dmai/linux/omap3530/Capture.c
index d41575d..12361d3 100644
--- a/dmai_2_20_00_15/packages/ti/sdo/dmai/linux/omap3530/Capture.c
+++ b/dmai_2_20_00_15/packages/ti/sdo/dmai/linux/omap3530/Capture.c
@@ -193,7 +193,7 @@ static int enumerate_all_entities(struct media_dev *media)
 	index = 0;
 	do {
 		memset(&media->entity[index], 0, sizeof(struct media_entity_desc));
-		media->entity[index].id = index | MEDIA_ENTITY_ID_FLAG_NEXT;
+		media->entity[index].id = index | MEDIA_ENT_ID_FLAG_NEXT;
 		ret = ioctl(media->media_fd, MEDIA_IOC_ENUM_ENTITIES, &media->entity[index]);
 		if (ret < 0) {
 			break;
@@ -247,12 +247,12 @@ static int reset_media_links(struct media_dev *media)
 			for(i = 0; i < media->entity[index].links; i++) {
 				link.source.entity = links.links->source.entity;
 				link.source.index = links.links->source.index;
-				link.source.flags = MEDIA_PAD_FLAG_OUTPUT;
+				link.source.flags = MEDIA_PAD_FL_SOURCE;
 				link.sink.entity = links.links->sink.entity;
 				link.sink.index = links.links->sink.index;
-				link.sink.flags = MEDIA_PAD_FLAG_INPUT;
-				link.flags = (link.flags & ~MEDIA_LINK_FLAG_ENABLED) |
-					(link.flags & MEDIA_LINK_FLAG_IMMUTABLE);
+				link.sink.flags = MEDIA_PAD_FL_SINK;
+				link.flags = (link.flags & ~MEDIA_LNK_FL_ENABLED) |
+					(link.flags & MEDIA_LNK_FL_IMMUTABLE);
 				ret = ioctl(media->media_fd, MEDIA_IOC_SETUP_LINK, &link);
 				if(ret)
 					break;
@@ -284,7 +284,7 @@ static int setup_media_links(struct media_dev *media)
 				printf("pads for entity %d=", media->entity[index].id);
 			for(i = 0 ; i < media->entity[index].pads; i++) {
 				printf("(%d %s) ", links.pads->index,
-						(links.pads->flags & MEDIA_PAD_FLAG_INPUT) ?
+						(links.pads->flags & MEDIA_PAD_FL_SINK) ?
 						"INPUT" : "OUTPUT");
 				links.pads++;
 			}
@@ -295,7 +295,7 @@ static int setup_media_links(struct media_dev *media)
 						links.links->source.index,
 						links.links->sink.entity,
 						links.links->sink.index);
-				if(links.links->flags & MEDIA_LINK_FLAG_ENABLED)
+				if(links.links->flags & MEDIA_LNK_FL_ENABLED)
 					printf("\tACTIVE\n");
 				else
 					printf("\tINACTIVE \n");
@@ -313,14 +313,14 @@ static int setup_media_links(struct media_dev *media)
 	printf("Enabling link [tvp5146]===>[ccdc]\n");
 	memset(&link, 0, sizeof(link));
 
-	link.flags |=  MEDIA_LINK_FLAG_ENABLED;
+	link.flags |=  MEDIA_LNK_FL_ENABLED;
 	link.source.entity = input;
 	link.source.index = 0;	/* Only 1 pad */
-	link.source.flags = MEDIA_PAD_FLAG_OUTPUT;
+	link.source.flags = MEDIA_PAD_FL_SOURCE;
 
 	link.sink.entity = media->ccdc;
 	link.sink.index = 0; /* Sink pad of CCDC, 0 */
-	link.sink.flags = MEDIA_PAD_FLAG_INPUT;
+	link.sink.flags = MEDIA_PAD_FL_SINK;
 
 	ret = ioctl(media->media_fd, MEDIA_IOC_SETUP_LINK, &link);
 	if(ret) {
@@ -333,14 +333,14 @@ static int setup_media_links(struct media_dev *media)
 	printf("Enabling link [ccdc]===>[video_node]\n");
 	memset(&link, 0, sizeof(link));
 
-	link.flags |=  MEDIA_LINK_FLAG_ENABLED;
+	link.flags |=  MEDIA_LNK_FL_ENABLED;
 	link.source.entity = media->ccdc;
 	link.source.index = 1; /* Source pad of CCDC: 1 */
-	link.source.flags = MEDIA_PAD_FLAG_OUTPUT;
+	link.source.flags = MEDIA_PAD_FL_SOURCE;
 
 	link.sink.entity = media->video;
 	link.sink.index = 0;
-	link.sink.flags = MEDIA_PAD_FLAG_INPUT;
+	link.sink.flags = MEDIA_PAD_FL_SINK;
 
 	ret = ioctl(media->media_fd, MEDIA_IOC_SETUP_LINK, &link);
 	if(ret)
-- 
1.7.0.4

